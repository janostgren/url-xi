{
    "testName": "SvtPlay Play Video",
    "description": "Play a video from the documentary category",
    "baseURL": "https://api.svt.se",
    "variables": [
        {
            "key": "format",
            "type": "string",
            "usage": "",
            "value": "dash-avc"
        },
        {
            "key": "svtId",
            "type": "string",
            "usage": "",
            "value": ""
        },
        {
            "key": "videoSvtId",
            "type": "string",
            "usage": "",
            "value": ""
        },
        {
            "key": "legacyId",
            "type": "number",
            "usage": "",
            "value": 0
        },
        {
            "key": "programTitle",
            "type": "string",
            "usage": "inResponse",
            "value": ""
        },
        {
            "key": "episodeTitle",
            "type": "string",
            "usage": "inResponse",
            "value": ""
        }
    ],
    "steps": [
        {
            "stepName": "Get Random documentary",
            "requests": [
                {
                    "config": {
                        "url": "/contento/graphql",
                        "params": {
                            "ua": "svtplaywebb-play-render-prod-client",
                            "operationName": "GenrePag",
                            "variables": {
                                "includes": "recommended",
                                "cluster": [
                                    "dokumentar"
                                ]
                            },
                            "extensions": {
                                "persistedQuery": {
                                    "version": 1,
                                    "sha256Hash": "868ba595956599c802d5bf45af0af6fec9765d8cead96728d6eff8ed64cb5238"
                                }
                            }
                        }
                    },
                    "extractors": [
                        {
                            "type": "jsonpath",
                            "expression": "$.data.genres[0].selectionsForWeb[0].items[0].item.urls.svtplay",
                            "variable": "urlSvtPlay"
                        }
                    ],
                    "transformers": [
                        {
                            "source": "{{urlSvtPlay}}",
                            "target": "legacyId, videoName",
                            "expression": "\\/video\/(\\d+)\/(.+)"
                        }
                    ]
                },
                {
                    "config": {
                        "url": "/contento/graphql",
                        "params": {
                            "ua": "svtplaywebb-play-render-prod-client",
                            "operationName": "VideoPage",
                            "variables": {
                                "legacyIds": [
                                    "{{legacyId}}"
                                ]
                            },
                            "extensions": {
                                "persistedQuery": {
                                    "version": 1,
                                    "sha256Hash": "6ae6ce26d0925cfbeae7d521ab8f512d14609c6188d81d7cfaa00c52847fcc49"
                                }
                            }
                        }
                    },
                    "extractors": [
                        {
                            "type": "jsonpath",
                            "expression": "$.data.listablesByEscenicId[0].svtId",
                            "variable": "svtId"
                        },
                        {
                            "type": "jsonpath",
                            "expression": "$.data.listablesByEscenicId[0].videoSvtId",
                            "variable": "videoSvtId"
                        }
                    ]
                }
            ]
        },
        {
            "stepName": "Get Video Meta data",
            "requests": [
                {
                    "config": {
                        "url": "/video/{{videoSvtId}}"
                    },
                    "extractors": [
                        {
                            "type": "jsonpath",
                            "expression": "$.programTitle",
                            "variable": "programTitle"
                        },
                        {
                            "type": "jsonpath",
                            "expression": "$.episodeTitle",
                            "variable": "episodeTitle"
                        },
                        {
                            "type": "jsonpath",
                            "expression": "$.videoReferences[?(@.format =='{{format}}')].resolve",
                            "variable": "resolver"
                        } 
                    ]
                },
                {
                    "config": {
                        "url": "{{resolver}}"
                    }
                }
            ]
        }
    ]
}